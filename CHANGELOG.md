# AIマラソンコーチ 更新履歴

## v1.5.1 (2026-02-14)

### 🔧 改善
- **Thinking Budget増加**: 思考予算を2048→4096トークンに引き上げ、後半の週の整合性を向上
- **MAX_OUTPUT_TOKENS増加**: 8192→16384トークンに引き上げ、13週分のJSON出力が途中で切れる問題を解消
- **テーブル項目名変更**: 週間トレーニング計画表の「先生からのアドバイス」を「AIコーチからのアドバイス」に変更

---

## v1.5.0 (2026-02-13)

### ✨ 大きな変更
- **Gemini 3 Flash Preview (Optimized) への完全移行**: トレーニング計画の生成ロジックを刷新し、より論理的かつVDOT理論に忠実な計画を作成するようにしました。
- **思考モード最適化**: Temperatureを `0.1` に設定し、創造性よりも論理的整合性を最優先。ハルシネーション（嘘の出力）を極限まで排除しました。
- **出力形式の堅牢化**: AIモデルからの出力をJSON形式で強制し、アプリ側でMarkdownに変換する方式に変更。これにより、フォーマット崩れや出力漏れを防ぎます。

### 🔧 改善・修正
- **2部練・ダブルスレッショルドの厳格化**: プロンプト制御により、ユーザーからの明示的なリクエストがない限り、2部練やダブルスレッショルドといった特殊なメニューが提案されないようにしました。
- **Thinking Budgetの適用**: 新しいGeminiモデルの仕様に合わせて、思考予算（2048トークン）を設定し、複雑な計算や論理構築をサポート。

---

## v1.4.2 (2026-02-13)

### 🐛 バグ修正
- **トレーニング計画の日付欠落を修正**: レース日から逆算して開始日を月曜日に調整する際、実際の週数が再計算されず、最大1週間分のトレーニング計画が欠落するバグを修正しました。
  - 例: 東京マラソン（3/1）向け12週計画で、2/16〜2/22の1週間が出力されない問題を解消。

---

## v1.4.1 (2026-01-22)

### 🛡️ 信頼性向上
- **API自動リトライ実装**: AI応答が空またはエラーの場合に、最大3回まで自動で再試行する機能を追加しました。
- **エラーハンドリング改善**: ユーザーに表示されるエラーメッセージをより分かりやすく改善しました。

---

## v1.4.0 (2026-01-19)

### 🔗 連携機能
- **VDOT計算機との連携**: URLパラメータによるフォーム自動入力機能を実装
  - `best_h`, `best_m`, `best_s`: 現在のベストタイム
  - `target_h`, `target_m`, `target_s`: 目標タイム
  - VDOT計算機から「AIマラソンコーチで練習計画を作成」をクリックすると、タイムが引き継がれます。

---

## v1.3.0 (2026-01-18)

### 🧠 AIモデル改善
- AIモデルを **Gemini 3 Flash Preview** (Thinking Model) に更新
- **思考モード最適化**: Temperature 1.0, 思考プロセス有効化
- トレーニング計画生成時の論理整合性チェック（負荷の漸進性、文脈統一など）を強化

---

## v1.2.0 (2026-01-18)

### 🎨 UI改善（Phase 8 続き）

#### 改善
- **API警告のExpander化**: st.info → Expander（折りたたみ）に変更し、ファーストビューをスッキリ
- **3ステップフローのレスポンシブ対応**: PC/スマホ両対応のサイズ調整（clamp()使用）
- スマホでも横3列表示を維持しつつ、文字サイズを最適化

---

## v1.1.0 (2026-01-17)

### 🎨 UI改善（Phase 8）

#### 新機能
- **3ステップフロー追加**: ヘッダー直下に「📝入力 → 🤖分析 → 📋取得」の視覚的フローを表示
- **開発者プロフィール**: フッターに開発者情報とブログリンクを追加
- **必須/任意バッジ**: 入力フォームに赤い「必須」、青い「任意」バッジを表示

#### 改善
- **API警告のソフト化**: st.warning → st.info（青色）に変更
- **バリデーション強化**: 未入力時にtoast通知とエラーメッセージを表示
- **生成中UX改善**: ボタン押下直後にtoast通知でフィードバック
- **デフォルト値変更**: 現在タイム 4:00:00、目標タイム 3:30:00（サブ4層向け）

---

## v1.0.0 (2026-01-14)

### 🚀 初期リリース

#### 機能
- ジャック・ダニエルズのVDOT理論に基づくトレーニング計画生成
- Google Gemini 3 Flash APIを使用したAIコーチング
- 4フェーズ構成の12週間トレーニング計画
- VDOT別許容差による目標自動調整
- 最低トレーニング条件の自動調整

#### 技術
- Streamlit Community Cloudでホスティング
- モジュール分割（src/vdot, src/ai, src/ui）
- ユニットテスト22件実装

---

*AIマラソンコーチ*
