# AIマラソンコーチ (AMC) - Claude Code Desktop コンテキスト

## 1. プロジェクト概要

| 項目 | 内容 |
|:-----|:-----|
| アプリ名 | AIマラソンコーチ |
| バージョン | 1.0.0 |
| 公開URL | https://akirun-ai-marathon-coach.streamlit.app/ |
| ブログLP | https://akirun.net/lp/ai-marathon-coach/ |
| 目的 | ジャック・ダニエルズ理論に基づくマラソントレーニング計画の自動生成 |
| 技術スタック | Python, Streamlit, Google Gemini API |

### 開発者情報
- **開発者**: あきら（AkiRun管理人）
- **実績**: フルマラソンPB 2:46:27（56歳）
- **ブログ**: https://akirun.net/（「走りを科学でアップデート」）

### ポジショニング
「科学で走る市民ランナーの専属コーチ」として、ダニエルズ理論を完全実装した**日本唯一**のAIトレーニング計画生成ツール。

---

## 2. 技術仕様

### アーキテクチャ
```
ai-marathon-coach/
├── app.py                    # メインアプリケーション
├── src/
│   ├── config.py             # 設定値・判定関数
│   ├── data_loader.py        # CSVデータ読み込み
│   ├── vdot/
│   │   ├── calculator.py     # VDOT計算
│   │   ├── paces.py          # ペース計算
│   │   └── training.py       # トレーニング期間計算
│   ├── ai/
│   │   └── gemini_client.py  # Gemini API連携
│   └── ui/
│       ├── components.py     # UIコンポーネント
│       └── styles.css        # スタイルシート
├── data/
│   ├── vdot_list.csv         # VDOTマスターデータ
│   └── vdot_pace.csv         # ペースマスターデータ
└── tests/                    # ユニットテスト（22件実装済）
```

### 主要設定値（src/config.py）

| 定数名 | デフォルト値 | 説明 |
|:-------|:-------------|:-----|
| GEMINI_MODEL_NAME | gemini-3-flash-preview | 使用するGeminiモデル |
| GEMINI_TEMPERATURE | 0.7 | 生成の創造性（0〜2） |
| GEMINI_MAX_OUTPUT_TOKENS | 32768 | 最大出力トークン数 |
| MIN_TRAINING_WEEKS | 12 | 最低トレーニング期間 |
| NUM_PHASES | 4 | フェーズ数 |

### VDOT別許容差（1サイクルあたり）

| 現在のVDOT | 許容VDOT差 | 対象レベル |
|:-----------|:-----------|:-----------|
| 〜40 | 4.0 | 初心者 |
| 40〜50 | 3.0 | 中級者 |
| 50〜55 | 2.5 | 上級者 |
| 55〜60 | 2.0 | エリート |
| 60以上 | 1.5 | トップエリート |

### 目標VDOT別の最低トレーニング条件

| 目標VDOT | 目標タイム目安 | 最低週間距離 | 最低練習日数 | 最低ポイント練習 |
|:---------|:---------------|:-------------|:-------------|:-----------------|
| 〜40 | サブ4以上 | 40km | 3日 | 1回 |
| 40〜45 | サブ3:40 | 50km | 4日 | 1回 |
| 45〜50 | サブ3:20 | 60km | 4日 | 2回 |
| 50〜55 | サブ3:00 | 80km | 5日 | 2回 |
| 55〜60 | サブ2:45 | 100km | 5日 | 2回 |
| 60以上 | サブ2:35以下 | 120km | 6日 | 3回 |

### AI出力構成（7セクション）
1. はじめに（挨拶、走力を褒め、計画のポイント）
2. 基本情報
3. VDOTとペースの説明
4. 4フェーズ構成の概要
5. 週間トレーニング計画（Markdown表形式）
6. 注意事項（ユーザー固有の内容含む5項目）
7. コーチからのメッセージ

---

## 3. UI改善タスク

### 優先度★★★（すぐやるべき）

#### 3.1 ファーストビューに「結果イメージ」を追加
**現状**: 最初に見えるのは「ご利用にあたってのお願い」の警告ボックス
**問題**: ユーザーが「何ができるアプリか」が伝わりにくい
**改善案**: 
- ヘッダー直下に「出力される計画のサンプル画像」を追加
- または「3ステップで計画作成」のような視覚的フローを表示

#### 3.2 API制限の警告をソフトに
**現状**: 黄色い警告ボックスが目立ちすぎ
**問題**: 「使いにくそう」という印象を与える可能性
**改善案**: 
- `st.warning` → `st.info`（青色）に変更
- または折りたたみExpander内に移動

#### 3.3 開発者プロフィールを追加【重要】
**現状**: 「誰が作ったか」がアプリ内に表示されていない
**問題**: 信頼性・ブログへの導線が弱い
**改善案**: サイドバーまたはフッターに以下を追加
```
開発者: あきら（PB 2:46:27 / 56歳）
ブログ: AkiRun | 走りを科学でアップデート
```

#### 3.4 AkiRunブログへの導線強化
**現状**: フッターに「© 2025 AkiRun」のみ
**改善案**: ヘッダーまたはサイドバーにロゴ付きリンクバナーを設置

### 優先度★★☆（1ヶ月以内）

#### 3.5 必須項目の明示【実際の操作で発見】
**現状**: どの項目が必須かわかりにくい（ニックネーム、本番レース名が必須）
**問題**: ユーザーが何を入力すればいいかわからず離脱する可能性
**改善案**: 
- 必須項目のラベルに「*」マークを付ける
- または「必須」バッジを表示
```python
st.text_input("ニックネーム *", placeholder="例: 太郎")
# または
st.text_input("ニックネーム", placeholder="例: 太郎", help="必須項目です")
```

#### 3.6 未入力時のバリデーション強化【実際の操作で発見】
**現状**: 必須項目が未入力でもボタンが押せる（押しても反応なし）
**問題**: ユーザーが「壊れている？」と思う可能性
**改善案**: 
- 未入力時はボタンを非活性化（`disabled=True`）
- または未入力でボタンを押した時にエラーメッセージを表示
```python
if not nickname or not race_name:
    st.button("🚀 トレーニング計画を作成", disabled=True)
    st.warning("ニックネームと本番レース名を入力してください")
else:
    if st.button("🚀 トレーニング計画を作成"):
        # 計画生成処理
```

#### 3.7 生成中の表示位置改善【実際の操作で発見】
**現状**: 「トレーニング計画を作成中...」がページ下部に表示され、スクロールしないと見えない
**問題**: ユーザーがボタンを押した後、反応がないと思ってしまう
**改善案**: 
- 生成中はページ上部に固定表示
- またはスピナーをボタンの近くに表示
```python
with st.spinner("🏃 トレーニング計画を作成中...（1〜2分程度かかります）"):
    # 計画生成処理
```

#### 3.8 入力フォームのデフォルト値変更
**現状**: 3:30:00 → 3:15:00（上級者向け）
**改善案**: 4:00:00 → 3:30:00（サブ4→サブ3.5）に変更
**理由**: ボリュームゾーンである「サブ4狙い」層に刺さる

#### 3.6 進捗表示の追加
**現状**: 入力項目が多く、完了までの距離がわかりにくい
**改善案**: 入力完了率を示すプログレスバーを「トレーニング計画を作成」ボタン上に表示

### 優先度★☆☆（将来）

#### 3.7 計画のPDF出力機能
**概要**: 12週計画を印刷可能なPDFで出力
**収益化オプション**: 500円/回の有料機能として検討

#### 3.8 Googleカレンダー連携
**概要**: 生成された計画をGoogleカレンダーにエクスポート

---

## 4. 収益化との連携

### ブログ記事との連動
- 「【無料】AIがダニエルズ式練習メニューを自動作成！」記事が存在
- アプリ内からブログ記事へ誘導 → アフィリエイト収益に貢献

### アフィリエイト連携ポイント
| 商品カテゴリ | 連携方法 |
|:-------------|:---------|
| 書籍（ダニエルズのランニング・フォーミュラ） | 計画生成後に「理論を深く知りたい方へ」として紹介 |
| GPS時計（Garmin、COROS） | 「練習ペースを正確に測るなら」として紹介 |
| シューズ | 目標タイム別のおすすめシューズをブログ記事で紹介 |

---

## 5. 次のアクション（実装優先順）

1. [ ] 開発者プロフィールをサイドバーに追加
2. [ ] AkiRunブログへのリンクバナーを追加
3. [ ] API警告を `st.info` に変更
4. [ ] ファーストビューに結果サンプル画像を追加
5. [ ] **必須項目に「*」マークを付ける**【新規】
6. [ ] **未入力時のバリデーション（ボタン非活性化 or エラー表示）**【新規】
7. [ ] **生成中の表示をわかりやすく（スピナー位置改善）**【新規】
8. [ ] デフォルト値を「サブ4→サブ3.5」に変更
9. [ ] プログレスバーを追加

---

## 6. 参考リンク

- **ブログトップ**: https://akirun.net/
- **アプリ紹介記事**: https://akirun.net/ai-marathon-coach-guide/
- **LP**: https://akirun.net/lp/ai-marathon-coach/
- **ダニエルズ理論参考**: ジャック・ダニエルズ著「ダニエルズのランニング・フォーミュラ」

---

## 7. 動作確認結果（2026年1月16日実施）

### テスト条件
| 項目 | 入力値 |
|:-----|:-------|
| ニックネーム | テスト |
| 年齢 | 40歳 |
| 性別 | 男性 |
| 現在のベストタイム | 3:30:00 |
| 目標タイム | 3:15:00 |
| 本番レース名 | 東京マラソン |
| 本番レース日 | 2026/04/16 |
| 週間走行距離 | 60km |
| 練習可能日数/週 | 6日 |
| ポイント練習回数/週 | 2回 |

### 結果
✅ **正常に12週間のトレーニング計画が生成された**

### 生成された計画の特徴
- 4フェーズ構成（基礎構築期→強化期→実践期→調整期）
- 各フェーズで目標VDOTが段階的に上昇（44.6→45.6→46.6→47.6）
- 日別の詳細メニュー（メニュー、距離、ペース、コーチアドバイス）
- レース週のテーパリング計画
- 「週間トレーニング計画をダウンロード」ボタンあり

### 発見された改善点
1. 必須項目（ニックネーム、本番レース名）が明示されていない
2. 未入力でボタンを押しても反応がない（エラー表示なし）
3. 生成中の表示がページ下部にあり、スクロールしないと見えない

---

*このファイルは2026年1月16日時点の情報に基づいています（動作確認済み）*
